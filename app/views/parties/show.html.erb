<h1><%=@party.title%></h1>
<h2><%=@party.description%></h2>

<% unless @party.photo.nil? %>
<%= image_tag "#{@party.photo}", height: 100, width: 300%>
<% else %>
<%= image_tag("default_image.jpg", size: "160x100", alt: "Default Party Image")%>
<% end %>

<div class="wrapper">
    <div class="container d-flex flex-column justify-content-center align-items-center">
      <div class="title text-center mb-5">
      </div>
      <div class="chart-wrapper">
        <div class="chart-container" style="position: relative; height:40vh; width:80vw">
        <canvas id="myChart"></canvas>
        </div>
      </div>
    </div>
  </div>
  <script>
  let ctx = document.getElementById('myChart').getContext('2d');
  const genres = []
  <% @genre.each do |genre| %>
    genres.push("<%= genre %>");
  <% end %>
  const occurrences = {}

genres.forEach((v) => {
  if (occurrences[v]) {
    occurrences[v] = occurrences[v] + 1
  } else occurrences[v] = 1
})

const sortable = [];
for (let o in occurrences) {
  sortable.push([o, occurrences[o]]);
}

sortable.sort(function(a, b) {
    return b[1] - a[1];
});

const genresByPopularity = {}

sortable.forEach(pair => {
  genresByPopularity[pair[0]] = pair[1]
})

let check = Object(genresByPopularity)

var array_keys = new Array();
var array_values = new Array();

for (var key in check) {
  array_keys.push(key);
  array_values.push(check[key])
}
//
//
console.log(array_keys.slice(0,5));
console.log(array_values.slice(0,5));
  let colorHex = ['#32C5FF', '#B620E0', '#F7B500', '#808080'];
  let myChart = new Chart(ctx, {
    type: 'doughnut',
    data: {
      datasets: [{
        data: array_values.slice(0,5),
        backgroundColor: colorHex
      }],
      labels: array_keys.slice(0,5)
    },
    options: {
      responsive: true,
      legend: {
        position: 'left',
        display: false

      },
      plugins: {
        datalabels: {
          color: '#fff',
          anchor: 'end',
          align: 'start',
          offset: -10,
          borderWidth: 2,
          borderColor: '#fff',
          borderRadius: 25,
          backgroundColor: (context) => {
            return context.dataset.backgroundColor;
          },
          font: {
            weight: 'bold',
            size: '10'
          },
          formatter: (value) => {
            return value;
          }
        }
      }
    }
  })

  </script>

<p><%= @danceability %>%</p>
<p><%= @energy %>%</p>
<p><%= @valence %>%</p>
<p><%= @popularity %>%</p>


<%= link_to "Tracks", party_playlist_tracks_path(@party.id, @party.playlist.id) %>


